- [1.命名规范](#1命名规范)
- [2.选择合适的字段类型](#2选择合适的字段类型)
- [3.主键设计要合理](#3主键设计要合理)
- [4.选择合适的字段长度](#4选择合适的字段长度)
- [5.每个表都需要添加create\_time等通用字段](#5每个表都需要添加create_time等通用字段)
- [6.一张表的字段不宜过多](#6一张表的字段不宜过多)
- [7.尽可能使用not null定义字段](#7尽可能使用not-null定义字段)
- [8.设计表时，评估哪些字段需要加索引](#8设计表时评估哪些字段需要加索引)
- [9.不需要严格遵守3NF,可以通过业务字段冗余减少表关联](#9不需要严格遵守3nf可以通过业务字段冗余减少表关联)
- [10.不推荐外键关联，一般都在代码维护](#10不推荐外键关联一般都在代码维护)
- [11.如果你的数据库字段是枚举，需要在comment注释清楚](#11如果你的数据库字段是枚举需要在comment注释清楚)

> <https://www.bilibili.com/video/BV1C44y1f7Rb>

# 1.命名规范

- 表字段名必须使用小写字母或者数字，禁止使用数字开头，禁止使用拼音，并且一般不使用英文缩写。
- 主键索引名为pk_字段名；唯一索引名为uk_字段名；普通索引名则为id×字段名。

```sql
反例：
acc_no,1_acc_no,zhanghao
正例：
account no,account number
```

# 2.选择合适的字段类型

设计表时，我们需要选择合适的字段类型，比如：

- 尽可能选择存储空间小的字段类型，就好像数字类型的，从tinyint、smallint、int、bigint从左往右开始选择
- 小数类型如金额，则选择decimal,禁止使用float和double。
- 如果存储的字符串长度几乎相等，使用char定长字符串类型。
- varchar是可变长字符串，不预先分配存储空间，长度不要超过58。
- 如果存储的值太大，建议字段类型修改为txt,同时抽出单独一张表，用主键与之对应。
- 同一表中，所有varchar字段的长度加起来，不能大于65535.如果有这样的需求，请使用TEXT/LONGTEXT类型。

# 3.主键设计要合理

主键设计的话，最好不要与业务逻辑有所关联。

# 4.选择合适的字段长度

在mysql中，`varchar和char`类型表示`字符长度`，而`其他类型`表示的长度都表示`字节长度`。字段长度一般设置为2的幂哈（也就是`2的n次方`）。'；

# 5.每个表都需要添加create_time等通用字段

表必备般来说，或具备这几个字段：

- id:主键，一个表必须得有主键，必须
- create_time:创建时间，必须
- modifed_time/update_.time:修改时间，必须，更新记录时，需要更新它
- version:数据记录的版本号，用于乐观锁，非必须
- remark:数据记录备注，非必须
- modified_by:修改人，非必须
- creator:创建人，非必须

# 6.一张表的字段不宜过多

一张表的字段不宜过多哈，一般尽量不要超过20个字段。当表的字段数非常多时，可以将表分成两张表，一张作为条件查询表，一张作为详细内容表(主要是为了性能考虑)。

# 7.尽可能使用not null定义字段

- 首先，NOT NULL可以防止出现空指针问题。
- 其次，ULL值存储也需要额外的空间的，它也会导致比较运算更为复杂，使优化器难以优化SQL。
- NULL值有可能会导致索引失效
- 如果将字段默认设置成一个空字符串或常量值并没有什么不同，且都不会影响到应用逻辑，那就可以将这个字段设置为NOT NULL。

# 8.设计表时，评估哪些字段需要加索引

首先，评估你的表数据量。如果你的表数据量只有一百几十行，就没有必要加索引。否则设计表的时候，如果有查询条件的字段，一般就需要建立索引。但是索引也不能滥用：

- 索引也不要建得太多，一般单表索引个数不要超过5个。因为创建过多的索引，会降低写得速度。
- 区分度不高的字段，不能加索引，如性别等
- 索引创建完后，还是要注意避免索引失效的情况，如使用mysql的内置函数，会导致索引失效的
- 索引过多的话，可以通过联合索引的话方式来优化。然后的话，索引还有一些规则，如覆盖索引，最左匹配原则等等
  
# 9.不需要严格遵守3NF,可以通过业务字段冗余减少表关联

什么是数据库三范式(3NF)

- 第一范式：对属性的原子性，要求属性具有原子性，不可再分解；
- 第二范式：对记录的唯一性，要求记录有唯一标识，即实体的唯一性，即不存在部分依赖；
- 第三方式：对字段的冗余性，要求任何字段不能由其他字段派生出来，它要求字段没有冗余，即不存在传递依赖；
![三范式](./image/三范式.png)
以上这张存放商品信息的基本表。总金额这个字段的存在，表明该表的设计不满足第三范式，因为总金额可以由单价*数量得到，说明总金额是冗余字段。但是，增加总金额这个冗余字段，可以提高查询统计的速度，这就是以空间换时间的作法。

# 10.不推荐外键关联，一般都在代码维护

- 使用外键存在性能问题、并发死锁问题、使用起来不方便等等。每次做DELETE或者UPDATE都必须考虑外键约束，会导致开发的时候很难受，测试数据造数据也不方便。
- 还有一个场景不能使用外键，就是分库分表。

# 11.如果你的数据库字段是枚举，需要在comment注释清楚

如果你设计的数据库字段是枚举类型的话，就需要在comment后面注释清楚每个枚举的意思，以便于维护

```sql
-- 正例如下：
session status varchar(2)COLLATE utf8 bin NOT NULL COMMENT 'session授权态'
-- 反例：
session status varchar(2)COLLATE utf8 bin NOT NULL COMMENT 'session'
```

并且，如果你的枚举类型在未来的版本有增加修改的话，也需要同时维护到comment后面。
